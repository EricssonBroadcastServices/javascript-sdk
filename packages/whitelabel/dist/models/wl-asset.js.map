{"version":3,"file":"wl-asset.js","sourceRoot":"/src/","sources":["models/wl-asset.ts"],"names":[],"mappings":"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","sourcesContent":["import { ImageScaler } from \"../utils/image-scaler\";\nimport { IWLCarouselItem } from \"../interfaces/wl-carousel-item\";\nimport { WLSeason } from \"./wl-season\";\nimport { Translations } from \"./wl-translations\";\nimport { WLProductOffering } from \"./wl-productoffering\";\nimport { getTimeString, getDurationLocalized } from \"../utils/time\";\nimport { getDayLocalized } from \"../utils/date\";\nimport {\n  jsonProperty,\n  AssetType,\n  Publication,\n  ImageModel,\n  ExternalReferences,\n  Participants,\n  Product,\n  UserLocation\n} from \"@ericssonbroadcastservices/exposure-sdk\";\n\nexport class WLTag {\n  @jsonProperty()\n  public title: string;\n  @jsonProperty()\n  public tagType: string;\n  @jsonProperty()\n  public id: string;\n}\n\nexport class WLAsset implements IWLCarouselItem {\n  @jsonProperty({ externalName: \"assetId\" })\n  public id: string;\n  @jsonProperty()\n  public type: AssetType;\n  @jsonProperty()\n  public assetId: string;\n  @jsonProperty()\n  public title: string;\n  @jsonProperty()\n  public description: string;\n  @jsonProperty({ type: ImageModel })\n  public images: ImageModel[];\n  @jsonProperty({ type: Publication })\n  public publications: Publication[] = [];\n  @jsonProperty({ type: ExternalReferences })\n  public externalReferences: ExternalReferences[] = [];\n  @jsonProperty()\n  public tvShowId: string;\n  @jsonProperty()\n  public season: number;\n  @jsonProperty({ type: Participants })\n  public participants: Participants[] = [];\n  @jsonProperty()\n  public startTime: Date;\n  @jsonProperty()\n  public endTime: Date;\n  @jsonProperty()\n  public duration: number;\n  @jsonProperty()\n  public year: number;\n  @jsonProperty({ type: WLTag })\n  public tags: WLTag[];\n  @jsonProperty()\n  public action: any;\n  @jsonProperty({ type: WLSeason })\n  public seasons: WLSeason[] = [];\n  @jsonProperty()\n  public bookmark?: {\n    percentage: number;\n    time: number;\n  };\n\n  public getDurationString = () => {\n    const assetDuration = this.duration;\n    if (!assetDuration) return;\n\n    return getDurationLocalized(assetDuration);\n  };\n\n  public getScaledImage(orientation: string, width: number) {\n    const imageUrl = this.images.find(image => image.orientation.toUpperCase() === orientation.toUpperCase())?.url;\n    return ImageScaler.fitToWidth(imageUrl, width);\n  }\n\n  public isLive = () => {\n    if (this.startTime && this.endTime) {\n      const now = new Date();\n      const startTime = new Date(this.startTime);\n      const endTime = new Date(this.endTime);\n      if (endTime > now && startTime <= now) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  public inFuture = () => {\n    if (this.publications.length === 0) {\n      return false;\n    }\n    return this.publications[0].fromDate.getTime() > Date.now();\n  };\n\n  public getIsEntitled = (availabilityKeys: string[]) => {\n    return this.getHasProperProduct(availabilityKeys) && !this.inFuture();\n  };\n\n  public getActionLink = (userEntitlements: Product[], availabilityKeys: string[]): string => {\n    switch (this.action?.type) {\n      case \"NavigateToDetails\":\n        return this.getBrowseLink();\n      case \"PlayAsset\":\n        return this.getPlayLink(userEntitlements, availabilityKeys);\n    }\n    return \"\";\n  };\n\n  public getBrowseLink = () => {\n    switch (this.type) {\n      case AssetType.TV_SHOW:\n        return `/asset/${this.assetId}`;\n      default:\n        return `/asset/${this.assetId}`;\n    }\n  };\n\n  public getPlayLink = (userEntitlements: Product[], availabilityKeys: string[]) => {\n    switch (this.type) {\n      case AssetType.TV_SHOW:\n        return `/asset/${this.assetId}`;\n      case AssetType.EPISODE:\n        return this.getIsEntitled(availabilityKeys)\n          ? `/play/${this.assetId}?playlist=season`\n          : `/asset/${this.assetId}`;\n      default:\n        /* if (this.materialType === \"LOW_LATENCY_CHANNEL\") {\n          return this.getIsEntitled(userEntitlements)\n            ? `/play/ll/${this.assetId}`\n            : `/asset/${this.assetId}`;\n        } */\n        if (this.tvShowId && this.season) {\n          return this.getIsEntitled(availabilityKeys)\n            ? `/play/${this.assetId}?playlist=season`\n            : `/asset/${this.assetId}`;\n        }\n        if (this.anonymousIsAllowed(userEntitlements)) {\n          return `/play/anonymous/${this.assetId}`;\n        }\n        return this.getIsEntitled(availabilityKeys) ? `/play/${this.assetId}` : `/asset/${this.assetId}`;\n    }\n  };\n  public requiredProducts = (): string[] => {\n    /* eslint-disable @typescript-eslint/ban-ts-ignore */\n    /* eslint-disable prefer-spread */\n    return [].concat.apply(\n      [],\n      // @ts-ignore\n      this.publications.map(pub => pub.products)\n    );\n  };\n\n  public getAvailabilityKeys = (): string[] => {\n    /* eslint-disable @typescript-eslint/ban-ts-ignore */\n    /* eslint-disable prefer-spread */\n    return [].concat.apply(\n      [],\n      // @ts-ignore\n      this.publications.map(pub => pub.availabilityKeys)\n    );\n  };\n\n  public getHasProperProduct = (userAvailabilityKeys: string[]) => {\n    const isEntitled = userAvailabilityKeys.filter(key => this.getAvailabilityKeys().includes(key));\n    return isEntitled.length > 0;\n  };\n  public getBuyableProductOfferings = (availableProductOfferings: WLProductOffering[]) => {\n    // TODO: solve this with proper typings, cannot find a solution now, hence eslint disable\n    const buyable = [].concat\n      .apply(\n        [],\n        // @ts-ignore\n        availableProductOfferings.map(po => po.productIds)\n      )\n      .filter(p => this.requiredProducts().includes(p));\n    // @ts-ignore\n    return availableProductOfferings.filter(po => po.productIds.filter(pId => buyable.includes(pId)).length > 0);\n  };\n\n  public getAnonymousProducts = (userEntitlements: Product[]) => {\n    return userEntitlements.filter(ut => ut.anonymousAllowed).map(ut => ut.id);\n  };\n\n  public anonymousIsAllowed = (userEntitlements: Product[]) => {\n    return this.getAnonymousProducts(userEntitlements).filter(p => this.requiredProducts().includes(p)).length > 0;\n  };\n\n  public getLocalAssetStartTimeString = () => {\n    if (this.getStartTime()) {\n      return getTimeString(this.startTime);\n    }\n    return null;\n  };\n  public getLocalStartDayString = (translations: Translations) => {\n    if (this.startTime) {\n      return getDayLocalized(this.startTime, translations);\n    }\n    return null;\n  };\n\n  public getStartTime = () => {\n    if (this.publications.length === 0 && !this.startTime) {\n      return undefined;\n    }\n    return this.startTime ? new Date(this.startTime) : this.publications[0].fromDate;\n  };\n\n  public isGeoBlocked = (location?: UserLocation) => {\n    if (!location) {\n      return false; // if we do not know, let the backend handle things\n    }\n    let isBlocked = false;\n    this.publications.forEach(publication => {\n      if (publication.countries.length > 0) {\n        if (!publication.countries.includes(location.countryCode)) {\n          isBlocked = true;\n        }\n      }\n    });\n    return isBlocked;\n  };\n}\n"]}